# Deploying to Vercel

FataPlus is optimized for deployment on Vercel, with Turborepo integration for efficient builds.

## Prerequisites

Before deploying to Vercel, you need:

1. A [Vercel account](https://vercel.com/signup)
2. The [Vercel CLI](https://vercel.com/docs/cli) installed
3. A GitHub repository with your FataPlus code

## Turborepo Integration

FataPlus uses Turborepo to optimize builds on Vercel. The key benefits are:

- **Faster Builds**: Only rebuild what changed
- **Caching**: Reuse build artifacts across deployments
- **Parallel Execution**: Build multiple apps simultaneously
- **Dependency Management**: Automatically handle internal dependencies

## Configuration Files

### 1. Vercel Configuration

The `vercel.json` file in the root directory configures the Vercel deployment:

```json
{
  "version": 2,
  "buildCommand": "npm run build",
  "outputDirectory": "apps/web/dist",
  "installCommand": "npm install",
  "framework": "vite",
  "github": {
    "silent": true
  }
}
```

### 2. Turborepo Pipeline

The `turbo.json` file defines the build pipeline:

```json
{
  "$schema": "https://turbo.build/schema.json",
  "globalDependencies": ["**/.env.*local"],
  "pipeline": {
    "build": {
      "dependsOn": ["^build"],
      "outputs": ["dist/**"]
    },
    "lint": {
      "outputs": []
    },
    "dev": {
      "cache": false,
      "persistent": true
    }
  }
}
```

## Deployment Steps

### Option 1: GitHub Integration (Recommended)

1. Push your code to GitHub
2. Connect your GitHub repository to Vercel
3. Configure the project settings:
   - **Framework Preset**: Vite
   - **Root Directory**: `./`
   - **Build Command**: `npm run build`
   - **Output Directory**: `apps/web/dist`
4. Set environment variables in the Vercel dashboard
5. Deploy

### Option 2: Vercel CLI

1. Log in to Vercel:
   ```bash
   vercel login
   ```

2. Deploy from the project root:
   ```bash
   vercel
   ```

3. Follow the prompts to configure your project

### Option 3: GitHub Actions

FataPlus includes GitHub Actions workflows for automated deployments:

```yaml
# .github/workflows/production-deploy.yml
name: Production Deployment

on:
  push:
    branches:
      - main

jobs:
  deploy-production:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Build
        run: npm run build
        
      - name: Deploy to Vercel
        uses: amondnet/vercel-action@v20
        with:
          vercel-token: ${{ secrets.VERCEL_TOKEN }}
          vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
          vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
          vercel-args: '--prod'
```

## Environment Variables

Set these environment variables in the Vercel dashboard:

| Variable | Description |
| --- | --- |
| `VITE_POCKETBASE_URL` | URL of your PocketBase instance |
| `VITE_APP_NAME` | Name of the application |
| `VITE_APP_URL` | URL of the application |

## Monorepo Deployment

When deploying a monorepo to Vercel:

1. Vercel automatically detects Turborepo
2. It uses Turborepo's remote caching for faster builds
3. It only builds the apps that have changed

## Preview Deployments

Vercel creates preview deployments for pull requests:

1. Create a pull request on GitHub
2. Vercel automatically builds and deploys a preview
3. The preview URL is added as a comment to the PR
4. Test the changes before merging

## Troubleshooting

### Build Failures

If your build fails:

1. Check the build logs in the Vercel dashboard
2. Ensure all dependencies are installed
3. Verify that the build command works locally
4. Check for environment variables that might be missing

### Caching Issues

If you suspect caching issues:

1. Clear the Turborepo cache:
   ```bash
   npx turbo clean
   ```

2. Rebuild locally:
   ```bash
   npm run build
   ```

3. Push the changes and redeploy
