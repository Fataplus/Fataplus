/**
 * üá≤üá¨ Madagascar Agriculture Knowledge Base for AutoRAG
 * Base de connaissances agricoles sp√©cialis√©e pour Madagascar
 */

export interface CropInfo {
  name: string
  varietiesMg: string[]
  regions: string[]
  seasons: string[]
  techniques: string[]
  challenges: string[]
  marketValue: '√âlev√©' | 'Moyen' | 'Faible'
  exportPotential: boolean
}

export interface ClimateInfo {
  region: string
  characteristics: string[]
  seasons: {
    name: string
    months: string
    description: string
  }[]
  risks: string[]
}

export const madagascarCrops: Record<string, CropInfo> = {
  riz: {
    name: "Riz (Vary)",
    varietiesMg: [
      "Riz Rouge de Lac Alaotra",
      "Makalioka", 
      "Rojofotsy",
      "X-Jigna",
      "FOFIFA 154",
      "NERICA"
    ],
    regions: [
      "Lac Alaotra (Alaotra-Mangoro)",
      "Hautes Terres Centrales",
      "Delta du Betsiboka",
      "Plaine de Marovoay"
    ],
    seasons: [
      "Vary aloha (Octobre - Mars)",
      "Vary vakiamindro (Avril - Septembre)"
    ],
    techniques: [
      "SRI (System of Rice Intensification)",
      "Tavy traditionnel",
      "Irrigation gravitaire",
      "Repiquage en ligne"
    ],
    challenges: [
      "Cyclones p√©riode novembre-avril",
      "Maladies fongiques",
      "Criquets migrateurs",
      "Acc√®s aux semences am√©lior√©es"
    ],
    marketValue: "√âlev√©",
    exportPotential: true
  },

  vanille: {
    name: "Vanille (Vanilka)",
    varietiesMg: [
      "Vanilla planifolia",
      "Vanille Bourbon",
      "Vanille fine"
    ],
    regions: [
      "SAVA (Sambava, Voh√©mar, Andapa, Antalaha)",
      "C√¥te Nord-Est",
      "Maroantsetra"
    ],
    seasons: [
      "Floraison: Septembre-Novembre",
      "Pollinisation: Octobre-D√©cembre", 
      "R√©colte: Juin-Ao√ªt"
    ],
    techniques: [
      "Pollinisation manuelle",
      "√âchaudage (60¬∞C)",
      "S√©chage traditionnel",
      "Affinage 6-8 mois"
    ],
    challenges: [
      "Vol de gousses vertes",
      "Cyclones fr√©quents",
      "Fluctuations prix international",
      "Qualit√© post-r√©colte"
    ],
    marketValue: "√âlev√©",
    exportPotential: true
  },

  clous_girofle: {
    name: "Clous de Girofle (Jirofo)",
    varietiesMg: [
      "Syzygium aromaticum traditionnel"
    ],
    regions: [
      "√éle Sainte-Marie",
      "C√¥te Est",
      "F√©n√©rive-Est",
      "Maroantsetra"
    ],
    seasons: [
      "R√©colte principale: Octobre-D√©cembre",
      "Petite r√©colte: Avril-Mai"
    ],
    techniques: [
      "Cueillette manuelle des boutons",
      "S√©chage au soleil",
      "Tri par qualit√©",
      "Conservation en sacs jute"
    ],
    challenges: [
      "Arbres vieillissants",
      "Concurrence Indon√©sie",
      "S√©chage en saison pluies",
      "Transport difficile"
    ],
    marketValue: "Moyen",
    exportPotential: true
  },

  cafe: {
    name: "Caf√© (Kafe)",
    varietiesMg: [
      "Arabica des Hautes Terres",
      "Robusta c√¥tier"
    ],
    regions: [
      "Antalaha",
      "Sambava", 
      "Hautes Terres Centrales",
      "Fianarantsoa"
    ],
    seasons: [
      "Floraison: Octobre-Novembre",
      "R√©colte: Avril-Septembre"
    ],
    techniques: [
      "Cueillette s√©lective",
      "Traitement voie humide",
      "S√©chage parche",
      "D√©corticage"
    ],
    challenges: [
      "Maladies (rouille)",
      "Vieillissement plantations",
      "Acc√®s march√©s √©quitables",
      "Transformation locale"
    ],
    marketValue: "Moyen",
    exportPotential: true
  },

  litchi: {
    name: "Litchi (Letchi)",
    varietiesMg: [
      "Kwa√Ø May Pink",
      "Mauritius",
      "Vari√©t√©s locales"
    ],
    regions: [
      "Tamatave (Toamasina)",
      "F√©n√©rive-Est",
      "Mananjary",
      "C√¥te Est"
    ],
    seasons: [
      "Floraison: Ao√ªt-Septembre",
      "R√©colte: Novembre-Janvier"
    ],
    techniques: [
      "Greffage sur porte-greffe local",
      "Taille de formation",
      "R√©colte √©chelonn√©e",
      "Conditionnement export"
    ],
    challenges: [
      "Courte saison",
      "Transport rapide requis",
      "Concurrence Maurice/R√©union",
      "Normes phytosanitaires export"
    ],
    marketValue: "√âlev√©",
    exportPotential: true
  }
}

export const madagascarClimate: ClimateInfo[] = [
  {
    region: "Hautes Terres Centrales",
    characteristics: [
      "Altitude 1200-1500m",
      "Climat temp√©r√© tropical",
      "Sols ferrallitiques rouges",
      "Temp√©rature 15-25¬∞C"
    ],
    seasons: [
      {
        name: "Saison s√®che",
        months: "Mai - Octobre",
        description: "P√©riode fra√Æche et s√®che, id√©ale pour la r√©colte"
      },
      {
        name: "Saison des pluies", 
        months: "Novembre - Avril",
        description: "P√©riode chaude et humide, saison de croissance"
      }
    ],
    risks: [
      "Gel occasionnel juin-ao√ªt",
      "Gr√™le en saison chaude",
      "S√©cheresse prolong√©e"
    ]
  },
  {
    region: "C√¥te Est",
    characteristics: [
      "Climat tropical humide",
      "Pluviom√©trie 2000-3000mm/an",
      "Sols alluviaux fertiles",
      "Temp√©rature 20-30¬∞C"
    ],
    seasons: [
      {
        name: "Saison cyclonique",
        months: "Novembre - Avril", 
        description: "Forte pluviom√©trie, risque cyclons"
      },
      {
        name: "Saison s√®che relative",
        months: "Mai - Octobre",
        description: "Moins de pluies mais toujours humide"
      }
    ],
    risks: [
      "Cyclones tropicaux",
      "Inondations",
      "Maladies cryptogamiques"
    ]
  },
  {
    region: "Sud Aride",
    characteristics: [
      "Climat semi-aride",
      "Pluviom√©trie 300-600mm/an",
      "Sols calcaires", 
      "Temp√©rature 18-35¬∞C"
    ],
    seasons: [
      {
        name: "Saison s√®che",
        months: "Avril - Novembre",
        description: "P√©riode tr√®s s√®che, irrigation n√©cessaire"
      },
      {
        name: "Saison des pluies",
        months: "D√©cembre - Mars",
        description: "Courte p√©riode pluvieuse irr√©guli√®re"
      }
    ],
    risks: [
      "S√©cheresse chronique",
      "Vents dess√©chants",
      "Invasion acridienne"
    ]
  }
]

export const agricultureCalendar = {
  "Janvier": {
    activities: [
      "R√©colte litchi",
      "Pr√©paration rizi√®res pour vary aloha",
      "Surveillance cyclones"
    ],
    regions: ["C√¥te Est", "Hautes Terres"]
  },
  "F√©vrier": {
    activities: [
      "Plantation riz vary aloha",
      "Entretien vanille",
      "Protection contre cyclones"
    ],
    regions: ["Toutes r√©gions"]
  },
  "Mars": {
    activities: [
      "Repiquage riz",
      "Taille caf√©iers",
      "Fin r√©colte litchi"
    ],
    regions: ["Lac Alaotra", "C√¥te Est"]
  },
  "Avril": {
    activities: [
      "D√©but r√©colte caf√©",
      "Plantation vary vakiamindro",
      "Pollinisation vanille"
    ],
    regions: ["SAVA", "Hautes Terres"]
  },
  "Mai": {
    activities: [
      "R√©colte caf√©",
      "Sarclage riz",
      "S√©chage clous de girofle"
    ],
    regions: ["Antalaha", "Alaotra"]
  },
  "Juin": {
    activities: [
      "D√©but r√©colte vanille",
      "Pr√©paration terres riz saison s√®che",
      "Traitement post-r√©colte caf√©"
    ],
    regions: ["SAVA", "Toutes r√©gions"]
  },
  "Juillet": {
    activities: [
      "R√©colte vanille continue",
      "√âchaudage vanille",
      "Plantation cultures vivri√®res"
    ],
    regions: ["SAVA", "Hautes Terres"]
  },
  "Ao√ªt": {
    activities: [
      "Fin r√©colte vanille",
      "Floraison litchi",
      "S√©chage vanille"
    ],
    regions: ["SAVA", "C√¥te Est"]
  },
  "Septembre": {
    activities: [
      "Affinage vanille",
      "R√©colte riz vary vakiamindro",
      "Pr√©paration campagne vary aloha"
    ],
    regions: ["SAVA", "Alaotra"]
  },
  "Octobre": {
    activities: [
      "Pollinisation vanille nouvelle saison",
      "Semis riz vary aloha",
      "R√©colte clous de girofle"
    ],
    regions: ["SAVA", "Lac Alaotra", "Sainte-Marie"]
  },
  "Novembre": {
    activities: [
      "Repiquage riz vary aloha",
      "Floraison vanille",
      "D√©but r√©colte litchi pr√©coce"
    ],
    regions: ["Toutes r√©gions"]
  },
  "D√©cembre": {
    activities: [
      "Entretien rizi√®res",
      "Pollinisation vanille",
      "R√©colte clous de girofle"
    ],
    regions: ["Toutes r√©gions"]
  }
}

export const commonProblems = {
  "Maladies du riz": {
    pyriculariose: {
      symptomes: "Taches brunes sur feuilles et panicules",
      traitement: "Vari√©t√©s r√©sistantes, rotation cultures",
      prevention: "√âviter exc√®s azote, drainage correct"
    },
    helminthosporiose: {
      symptomes: "Taches ovales brunes bord√©es jaune",
      traitement: "Fongicides cupriques, vari√©t√©s tol√©rantes", 
      prevention: "Rotation, destruction r√©sidus"
    }
  },
  "Ravageurs vanille": {
    punaises: {
      symptomes: "Piq√ªres sur gousses, dess√®chement",
      traitement: "Ramassage manuel, pi√®ges",
      prevention: "Nettoyage tuteurs, d√©sherbage"
    },
    pourriture_noire: {
      symptomes: "Noircissement gousses immatures",
      traitement: "√âlimination gousses atteintes",
      prevention: "Drainage, a√©ration, √©viter blessures"
    }
  },
  "Probl√®mes g√©n√©raux": {
    s√©cheresse: {
      symptomes: "Fl√©trissement, jaunissement feuilles",
      traitement: "Irrigation d'appoint, paillage",
      prevention: "Mulching, cultures associ√©es, r√©tention eau"
    },
    cyclones: {
      symptomes: "Casse, d√©racinage, inondation",
      traitement: "√âlagage, drainage, replantation",
      prevention: "Vari√©t√©s r√©sistantes, brise-vents"
    }
  }
}

/**
 * Fonction pour rechercher dans la base de connaissances
 */
export function searchKnowledge(query: string): string[] {
  const results: string[] = []
  const searchTerm = query.toLowerCase()

  // Recherche dans les cultures
  Object.entries(madagascarCrops).forEach(([key, crop]) => {
    if (
      crop.name.toLowerCase().includes(searchTerm) ||
      crop.varietiesMg.some(v => v.toLowerCase().includes(searchTerm)) ||
      crop.regions.some(r => r.toLowerCase().includes(searchTerm))
    ) {
      results.push(`Culture: ${crop.name} - R√©gions: ${crop.regions.join(', ')}`)
    }
  })

  // Recherche dans le calendrier
  Object.entries(agricultureCalendar).forEach(([month, data]) => {
    if (data.activities.some(a => a.toLowerCase().includes(searchTerm))) {
      results.push(`${month}: ${data.activities.join(', ')}`)
    }
  })

  return results
} 